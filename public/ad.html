
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN COMMAND CENTER</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background: linear-gradient(135deg, #1a0000 0%, #330000 50%, #1a0000 100%);
            color: #ff3333;
            min-height: 100vh;
            overflow-x: auto;
        }

        .terminal-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 0, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 51, 51, 0.1) 0%, transparent 50%),
                linear-gradient(45deg, transparent 49%, rgba(255, 0, 0, 0.02) 50%, transparent 51%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #ff3333;
            border-radius: 0;
            box-shadow: 
                0 0 20px rgba(255, 51, 51, 0.3),
                inset 0 0 20px rgba(255, 0, 0, 0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .header {
            color: #fff;
            padding: 20px;
            text-align: center;
            border-bottom: 3px solid #ff3333;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            animation: scanline 3s infinite;
        }

        @keyframes scanline {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .ascii-art {
            font-family: 'JetBrains Mono', monospace;
            font-size: 8px;
            line-height: 1;
            color: #ff6666;
            text-shadow: 0 0 5px #ff3333;
            margin-bottom: 15px;
            white-space: pre;
        }

        .header h1 {
            font-size: 32px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            position: relative;
            z-index: 1;
        }

        .auth-section {
            background: linear-gradient(135deg, #220000 0%, #330000 100%);
            border: 1px solid #ff3333;
            padding: 25px;
            margin: 20px;
            border-radius: 0;
            box-shadow: 
                0 0 15px rgba(255, 51, 51, 0.3),
                inset 0 0 15px rgba(255, 0, 0, 0.1);
        }

        .auth-section.authenticated {
            background: linear-gradient(135deg, #002200 0%, #003300 100%);
            border-color: #00ff00;
            box-shadow: 
                0 0 15px rgba(0, 255, 0, 0.3),
                inset 0 0 15px rgba(0, 255, 0, 0.1);
        }

        .terminal-prompt {
            color: #ff6666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .terminal-prompt::before {
            content: "Admin Panel Login: ";
            color: #ff3333;
            font-weight: bold;
        }

        .token-input {
            width: 350px;
            padding: 12px 16px;
            border: 2px solid #ff3333;
            border-radius: 0;
            background: rgba(0, 0, 0, 0.8);
            color: #ff6666;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            margin-right: 15px;
            outline: none;
            box-shadow: inset 0 0 10px rgba(255, 51, 51, 0.2);
        }

        .token-input:focus {
            border-color: #ff6666;
            box-shadow: 
                inset 0 0 10px rgba(255, 51, 51, 0.3),
                0 0 10px rgba(255, 51, 51, 0.5);
        }

        .auth-btn {
            background: linear-gradient(135deg, #ff3333 0%, #cc0000 100%);
            color: #fff;
            padding: 12px 24px;
            border: none;
            border-radius: 0;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(255, 51, 51, 0.3);
        }

        .auth-btn:hover {
            background: linear-gradient(135deg, #ff6666 0%, #ff3333 100%);
            box-shadow: 0 6px 12px rgba(255, 51, 51, 0.5);
            transform: translateY(-2px);
        }

        .logout-btn {
            background: linear-gradient(135deg, #cc0000 0%, #990000 100%);
            margin-left: 15px;
        }

        .dashboard-section {
            padding: 25px;
            background: linear-gradient(135deg, rgba(255, 51, 51, 0.05) 0%, rgba(0, 0, 0, 0.3) 100%);
            border-bottom: 2px solid #ff3333;
        }

        .dashboard-title {
            font-size: 24px;
            font-weight: 700;
            color: #ff6666;
            margin: 0 0 25px 0;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px #ff3333;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 15px;
        }

        .dashboard-card {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9) 0%, rgba(51, 0, 0, 0.7) 100%);
            border: 2px solid #ff3333;
            border-radius: 0;
            padding: 25px;
            box-shadow: 
                0 0 15px rgba(255, 51, 51, 0.3),
                inset 0 0 15px rgba(255, 0, 0, 0.1);
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #ff6666, transparent);
            animation: cardScan 4s infinite;
        }

        @keyframes cardScan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .dashboard-card:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 8px 25px rgba(255, 51, 51, 0.5),
                inset 0 0 25px rgba(255, 0, 0, 0.2);
            border-color: #ff6666;
        }

        .dashboard-card.success {
            border-color: #00ff00;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9) 0%, rgba(0, 51, 0, 0.7) 100%);
        }

        .dashboard-card.success::before {
            background: linear-gradient(90deg, transparent, #00ff66, transparent);
        }

        .dashboard-card.error {
            border-color: #ff0000;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9) 0%, rgba(51, 0, 0, 0.9) 100%);
        }

        .dashboard-card.info {
            border-color: #0099ff;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 51, 0.7) 100%);
        }

        .dashboard-card.info::before {
            background: linear-gradient(90deg, transparent, #0099ff, transparent);
        }

        .dashboard-card-icon {
            font-size: 32px;
            margin-right: 20px;
            text-shadow: 0 0 10px currentColor;
        }

        .dashboard-card-content {
            flex: 1;
        }

        .dashboard-card-number {
            font-size: 36px;
            font-weight: 700;
            color: #ff6666;
            line-height: 1;
            margin-bottom: 8px;
            text-shadow: 0 0 15px currentColor;
        }

        .dashboard-card.success .dashboard-card-number {
            color: #00ff66;
        }

        .dashboard-card.error .dashboard-card-number {
            color: #ff3333;
        }

        .dashboard-card.info .dashboard-card-number {
            color: #0099ff;
        }

        .dashboard-card-label {
            font-size: 14px;
            color: #999;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .sessions-header {
            padding: 25px 25px 0 25px;
            background: linear-gradient(135deg, rgba(255, 51, 51, 0.05) 0%, rgba(0, 0, 0, 0.3) 100%);
        }

        .sessions-header h2 {
            font-size: 24px;
            font-weight: 700;
            color: #ff6666;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px #ff3333;
        }

        .sessions-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(0, 0, 0, 0.8);
        }

        .sessions-table th {
            background: linear-gradient(135deg, #330000 0%, #220000 100%);
            padding: 20px;
            text-align: left;
            font-weight: 700;
            color: #ff6666;
            border: 1px solid #ff3333;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 14px;
        }

        .sessions-table td {
            padding: 20px;
            border: 1px solid #ff3333;
            vertical-align: middle;
            background: rgba(0, 0, 0, 0.6);
        }

        .sessions-table tr:hover td {
            background: rgba(255, 51, 51, 0.1);
            box-shadow: inset 0 0 10px rgba(255, 51, 51, 0.2);
        }

        .email-cell {
            font-weight: 500;
            color: #ff6666;
            text-shadow: 0 0 5px #ff3333;
        }

        .password-container {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .password-masked,
        .password-revealed {
            font-family: 'JetBrains Mono', monospace;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border: 1px solid #ff3333;
            border-radius: 0;
            font-size: 12px;
            color: #ff6666;
        }

        .password-revealed {
            background: rgba(255, 51, 51, 0.1);
            border-color: #ff6666;
            word-break: break-all;
        }

        .reveal-btn {
            background: linear-gradient(135deg, #666 0%, #333 100%);
            color: #fff;
            padding: 6px 12px;
            border: 1px solid #ff3333;
            border-radius: 0;
            cursor: pointer;
            font-size: 11px;
            margin-left: 10px;
            font-family: 'JetBrains Mono', monospace;
            text-transform: uppercase;
            transition: all 0.3s ease;
        }

        .reveal-btn:hover {
            background: linear-gradient(135deg, #ff3333 0%, #cc0000 100%);
        }

        .download-btn {
            background: linear-gradient(135deg, #00aa00 0%, #006600 100%);
            color: #fff;
            padding: 10px 18px;
            border: 1px solid #00ff00;
            border-radius: 0;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            font-size: 13px;
            font-family: 'JetBrains Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }

        .download-btn:hover {
            background: linear-gradient(135deg, #00ff00 0%, #00aa00 100%);
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
        }

        .session-info {
            font-size: 12px;
            color: #999;
            margin-top: 8px;
            font-family: 'JetBrains Mono', monospace;
        }

        .auth-status {
            margin-bottom: 20px;
            font-weight: 500;
            font-size: 16px;
            color: #ff6666;
        }

        .loading,
        .error,
        .no-sessions {
            text-align: center;
            padding: 50px;
            color: #ff6666;
            font-size: 18px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .error {
            color: #ff3333;
            text-shadow: 0 0 10px #ff3333;
        }

        .glitch {
            animation: glitch 2s infinite;
        }

        @keyframes glitch {
            0%, 90%, 100% { transform: translate(0); }
            10% { transform: translate(-1px, -1px); }
            20% { transform: translate(1px, 1px); }
            30% { transform: translate(-1px, 1px); }
            40% { transform: translate(1px, -1px); }
            50% { transform: translate(-1px, -1px); }
            60% { transform: translate(1px, 1px); }
            70% { transform: translate(-1px, 1px); }
            80% { transform: translate(1px, -1px); }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: #000;
            border: 1px solid #ff3333;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #ff3333 0%, #cc0000 100%);
            border-radius: 0;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #ff6666 0%, #ff3333 100%);
        }

        .cloudflare-control-panel {
            background: linear-gradient(135deg, rgba(0, 153, 255, 0.1) 0%, rgba(0, 0, 0, 0.8) 100%);
            border: 2px solid #0099ff;
            border-radius: 0;
            padding: 25px;
            box-shadow: 
                0 0 15px rgba(0, 153, 255, 0.3),
                inset 0 0 15px rgba(0, 153, 255, 0.1);
        }

        .cf-control-btn {
            background: linear-gradient(135deg, #0099ff 0%, #0066cc 100%);
            color: #fff;
            padding: 12px 20px;
            border: 2px solid #0099ff;
            border-radius: 0;
            cursor: pointer;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 10px;
            font-size: 12px;
        }

        .cf-control-btn:hover {
            background: linear-gradient(135deg, #00ccff 0%, #0099ff 100%);
            box-shadow: 0 0 15px rgba(0, 153, 255, 0.5);
            transform: translateY(-1px);
        }

        .cf-control-btn.cf-emergency {
            background: linear-gradient(135deg, #ff3333 0%, #cc0000 100%);
            border-color: #ff3333;
        }

        .cf-control-btn.cf-emergency:hover {
            background: linear-gradient(135deg, #ff6666 0%, #ff3333 100%);
            box-shadow: 0 0 15px rgba(255, 51, 51, 0.5);
        }

        .cf-control-btn.cf-disable {
            background: linear-gradient(135deg, #666 0%, #333 100%);
            border-color: #666;
        }

        .cf-control-btn.cf-disable:hover {
            background: linear-gradient(135deg, #999 0%, #666 100%);
            box-shadow: 0 0 15px rgba(153, 153, 153, 0.5);
        }

        .cf-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #0099ff;
            border-radius: 0;
            background: rgba(0, 0, 0, 0.8);
            color: #0099ff;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            margin-bottom: 10px;
            outline: none;
        }

        .cf-select:focus {
            box-shadow: 0 0 10px rgba(0, 153, 255, 0.5);
        }

        .control-description {
            font-size: 11px;
            color: #999;
            font-style: italic;
            margin-top: 8px;
            line-height: 1.4;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 24px;
            }
            
            .ascii-art {
                font-size: 8px;
            }
            
            .token-input {
                width: 100%;
                margin-bottom: 15px;
                margin-right: 0;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="terminal-bg"></div>
    
    <div class="container">
        <div class="header">
            <div class="ascii-art">
                
                 dP""b8 88     .dP"Y8       db    8888b.  8b    d8 88 88b 88    88""Yb    db    88b 88 888888 88     
                dP   `" 88     `Ybo."      dPYb    8I  Yb 88b  d88 88 88Yb88    88__dP   dPYb   88Yb88 88__   88     
                Yb      88  .o o.`Y8b     dP__Yb   8I  dY 88YbdP88 88 88 Y88    88"""   dP__Yb  88 Y88 88""   88  .o 
                 YboodP 88ood8 8bodP'    dP""""Yb 8888Y"  88 YY 88 88 88  Y8    88     dP""""Yb 88  Y8 888888 88ood8 
                
            </div>
            <h1 class="glitch">üö∏ </h1>
        </div>

        <!-- Authentication Terminal -->
        <div id="auth-section" class="auth-section">
            <div class="terminal-prompt">AUTHENTICATION REQUIRED</div>
            
            <div id="auth-form">
                <input type="password" 
                       id="token-input" 
                       class="token-input" 
                       placeholder="ENTER PANEL TOKEN..." 
                       onkeypress="if(event.key==='Enter') authenticate()">
                <button onclick="authenticate()" class="auth-btn">AUTHENTICATE</button>
            </div>
            <div id="auth-success" style="display: none;">
                ‚úÖ ACCESS GRANTED - WELCOME TO THE MATRIX
                <button onclick="logout()" class="auth-btn logout-btn">LOGOUT</button>
            </div>
        </div>

        <!-- Analytics Command Center -->
        <div id="dashboard-section" class="dashboard-section">
            <h2 class="dashboard-title">SYSTEM ANALYTICS OVERVIEW</h2>
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <div class="dashboard-card-icon">üìä</div>
                    <div class="dashboard-card-content">
                        <div class="dashboard-card-number" id="total-visits">-</div>
                        <div class="dashboard-card-label">Total Visits</div>
                    </div>
                </div>
                <div class="dashboard-card success">
                    <div class="dashboard-card-icon">‚úÖ</div>
                    <div class="dashboard-card-content">
                        <div class="dashboard-card-number" id="valid-entries">-</div>
                        <div class="dashboard-card-label">Valid Entries</div>
                    </div>
                </div>
                <div class="dashboard-card error">
                    <div class="dashboard-card-icon">‚ùå</div>
                    <div class="dashboard-card-content">
                        <div class="dashboard-card-number" id="invalid-entries">-</div>
                        <div class="dashboard-card-label">Invalid Entries</div>
                    </div>
                </div>
                <div class="dashboard-card info">
                    <div class="dashboard-card-icon">üìà</div>
                    <div class="dashboard-card-content">
                        <div class="dashboard-card-number" id="success-rate">-</div>
                        <div class="dashboard-card-label">Success Rate</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cloudflare Security Control Center -->
        <div id="cloudflare-section" class="dashboard-section" style="border-bottom: 2px solid #0099ff;">
            <h2 class="dashboard-title" style="color: #0099ff; text-shadow: 0 0 10px #0099ff;">CLOUDFLARE SECURITY MATRIX</h2>
            
            <div class="dashboard-grid">
                <div class="dashboard-card info">
                    <div class="dashboard-card-icon">üõ°Ô∏è</div>
                    <div class="dashboard-card-content">
                        <div class="dashboard-card-number" id="cf-status" style="color: #0099ff;">LOADING</div>
                        <div class="dashboard-card-label">System Status</div>
                    </div>
                </div>
                <div class="dashboard-card" id="bot-fight-card">
                    <div class="dashboard-card-icon">ü§ñ</div>
                    <div class="dashboard-card-content">
                        <div class="dashboard-card-number" id="bot-fight-status">OFF</div>
                        <div class="dashboard-card-label">Bot Fight Mode</div>
                    </div>
                </div>
                <div class="dashboard-card" id="security-level-card">
                    <div class="dashboard-card-icon">üîí</div>
                    <div class="dashboard-card-content">
                        <div class="dashboard-card-number" id="security-level-status">MEDIUM</div>
                        <div class="dashboard-card-label">Security Level</div>
                    </div>
                </div>
                <div class="dashboard-card" id="browser-check-card">
                    <div class="dashboard-card-icon">üåê</div>
                    <div class="dashboard-card-content">
                        <div class="dashboard-card-number" id="browser-check-status">ON</div>
                        <div class="dashboard-card-label">Browser Check</div>
                    </div>
                </div>
            </div>

            <div style="margin-top: 30px; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <!-- Bot Fight Mode Control -->
                <div class="cloudflare-control-panel">
                    <h3 style="color: #ff6666; margin-bottom: 15px; text-transform: uppercase;">ü§ñ Bot Protection</h3>
                    <button onclick="toggleBotFight()" id="bot-fight-btn" class="cf-control-btn">
                        TOGGLE BOT FIGHT MODE
                    </button>
                    <div class="control-description">
                        Controls automated bot detection and blocking
                    </div>
                </div>

                <!-- Security Level Control -->
                <div class="cloudflare-control-panel">
                    <h3 style="color: #ff6666; margin-bottom: 15px; text-transform: uppercase;">üîí Security Level</h3>
                    <select id="security-level-select" class="cf-select" onchange="setSecurityLevel()">
                        <option value="off">Off</option>
                        <option value="essentially_off">Essentially Off</option>
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                        <option value="under_attack">Under Attack</option>
                    </select>
                    <div class="control-description">
                        Adjusts challenge sensitivity for suspicious traffic
                    </div>
                </div>

                <!-- Browser Integrity Check -->
                <div class="cloudflare-control-panel">
                    <h3 style="color: #ff6666; margin-bottom: 15px; text-transform: uppercase;">üåê Browser Check</h3>
                    <button onclick="toggleBrowserCheck()" id="browser-check-btn" class="cf-control-btn">
                        TOGGLE BROWSER CHECK
                    </button>
                    <div class="control-description">
                        Validates browser integrity and headers
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="cloudflare-control-panel">
                    <h3 style="color: #ff6666; margin-bottom: 15px; text-transform: uppercase;">‚ö° Quick Actions</h3>
                    <button onclick="enableUnderAttack()" class="cf-control-btn cf-emergency">
                        UNDER ATTACK MODE
                    </button>
                    <button onclick="disableAllProtection()" class="cf-control-btn cf-disable">
                        DISABLE ALL PROTECTION
                    </button>
                    <div class="control-description">
                        Emergency controls for immediate response
                    </div>
                </div>
            </div>
        </div>

        <!-- Sessions Database -->
        <div class="sessions-header">
            <h2>ENCRYPTED SESSION DATABASE</h2>
        </div>

        <div id="loading" class="loading">
            LOADING CLASSIFIED DATA...
        </div>

        <div id="error" class="error" style="display: none;">
            SYSTEM ERROR - DATA COMPROMISED
        </div>

        <div id="sessions-content" style="display: none;">
            <table class="sessions-table">
                <thead>
                    <tr>
                        <th>STATUS</th>
                        <th>EMAIL ADDRESS</th>
                        <th>ENCRYPTED PASSWORD</th>
                        <th>INJECTION SCRIPT</th>
                        <th>SESSION METADATA</th>
                    </tr>
                </thead>
                <tbody id="sessions-tbody">
                </tbody>
            </table>
        </div>

        <div id="no-sessions" class="no-sessions" style="display: none;">
            NO CLASSIFIED SESSIONS FOUND
        </div>
    </div>

    <script>
        // Authentication state
        let isAuthenticated = false;
        let adminToken = null;

        // Check if user is already authenticated on page load
        function checkAuthOnLoad() {
            const storedToken = localStorage.getItem('adminToken');
            if (storedToken) {
                adminToken = storedToken;
                updateAuthUI(true);
                // Load analytics immediately
                setTimeout(() => {
                    loadAnalytics();
                    loadSessions();
                }, 100);
            } else {
                updateAuthUI(false);
            }
        }

        // Update authentication UI
        function updateAuthUI(authenticated) {
            isAuthenticated = authenticated;
            const authSection = document.getElementById('auth-section');
            const authForm = document.getElementById('auth-form');
            const authSuccess = document.getElementById('auth-success');
            const authStatus = document.getElementById('auth-status');
            const loading = document.getElementById('loading');
            const sessionsContent = document.getElementById('sessions-content');
            const noSessions = document.getElementById('no-sessions');

            if (authenticated) {
                authSection.classList.add('authenticated');
                authForm.style.display = 'none';
                authSuccess.style.display = 'block';
                loading.style.display = 'block';
                sessionsContent.style.display = 'none';
                noSessions.style.display = 'none';
            } else {
                authSection.classList.remove('authenticated');
                authForm.style.display = 'block';
                authSuccess.style.display = 'none';
                loading.style.display = 'none';
                sessionsContent.style.display = 'none';
                noSessions.style.display = 'none';
                document.getElementById('error').style.display = 'none';
            }
        }

        // Authenticate with token
        async function authenticate() {
            const tokenInput = document.getElementById('token-input');
            const token = tokenInput.value.trim();

            if (!token) {
                alert('SECURITY ALERT: TOKEN REQUIRED FOR ACCESS');
                return;
            }

            try {
                // Test the token by making a request to the sessions endpoint
                const response = await fetch('/api/admin/sessions?token=' + encodeURIComponent(token));
                
                if (response.ok) {
                    adminToken = token;
                    localStorage.setItem('adminToken', token);
                    updateAuthUI(true);
                    loadSessions();
                    loadAnalytics(); // Ensure analytics load after authentication
                    tokenInput.value = '';
                } else if (response.status === 401) {
                    alert('ACCESS DENIED: INVALID TOKEN DETECTED');
                } else {
                    alert('AUTHENTICATION FAILED: SYSTEM ERROR');
                }
            } catch (error) {
                console.error('Authentication error:', error);
                alert('NETWORK ERROR: CONNECTION TO MAINFRAME FAILED');
            }
        }

        // Logout
        function logout() {
            adminToken = null;
            localStorage.removeItem('adminToken');
            updateAuthUI(false);
        }

        // Get stored token for API calls
        function getStoredToken() {
            return adminToken || localStorage.getItem('adminToken') || '';
        }

        // Toggle password visibility
        function togglePassword(index, password) {
            const passwordDiv = document.getElementById(`password-${index}`);
            const button = document.getElementById(`reveal-btn-${index}`);
            
            if (passwordDiv.classList.contains('password-masked')) {
                // Reveal password
                passwordDiv.className = 'password-revealed';
                passwordDiv.textContent = password;
                button.textContent = 'HIDE';
            } else {
                // Hide password
                passwordDiv.className = 'password-masked';
                const passwordMask = '‚ñà'.repeat(Math.min(password.length, 12));
                passwordDiv.textContent = passwordMask;
                button.textContent = 'SHOW';
            }
        }

        async function loadSessions() {
            if (!isAuthenticated) {
                return;
            }

            try {
                const token = getStoredToken();
                const response = await fetch(`/api/admin/sessions?token=${encodeURIComponent(token)}`);
                
                if (response.status === 401) {
                    // Token expired or invalid
                    logout();
                    alert('SESSION EXPIRED: RE-AUTHENTICATION REQUIRED');
                    return;
                }

                const sessions = await response.json();

                document.getElementById('loading').style.display = 'none';

                if (!sessions.sessions || sessions.sessions.length === 0) {
                    document.getElementById('no-sessions').style.display = 'block';
                    return;
                }

                const tbody = document.getElementById('sessions-tbody');
                tbody.innerHTML = '';

                sessions.sessions.forEach((session, index) => {
                    const row = document.createElement('tr');
                    
                    // Style the row based on status
                    if (session.status === 'invalid') {
                        row.style.backgroundColor = 'rgba(255, 51, 51, 0.1)';
                        row.style.borderLeft = '4px solid #ff3333';
                    } else {
                        row.style.backgroundColor = 'rgba(0, 255, 0, 0.05)';
                        row.style.borderLeft = '4px solid #00ff00';
                    }
                    
                    // Handle password column based on status
                    let passwordColumn = '';
                    if (session.status === 'valid' && session.password) {
                        // Decode base64 password for valid sessions
                        let decodedPassword = session.password;
                        try {
                            decodedPassword = atob(session.password);
                        } catch (e) {
                            decodedPassword = session.password;
                        }
                        const passwordMask = '‚ñà'.repeat(Math.min(decodedPassword.length, 12));
                        
                        passwordColumn = `
                            <div class="password-container">
                                <div id="password-${index}" class="password-masked">
                                    ${passwordMask}
                                </div>
                                <button onclick="togglePassword(${index}, '${decodedPassword.replace(/'/g, "\\'")}')"
                                    id="reveal-btn-${index}" class="reveal-btn">SHOW</button>
                            </div>
                        `;
                    } else if (session.status === 'invalid') {
                        // Show reason for invalid entries
                        const reason = session.reason || 'FAILED ENTRY';
                        passwordColumn = `<span style="color: #ff6666; font-weight: bold;">‚ùå ${reason.toUpperCase()}</span>`;
                    } else {
                        // Fallback for other cases
                        passwordColumn = `<span style="color: #666;">N/A - NO PASSWORD</span>`;
                    }

                    // Handle inject script column
                    let injectColumn = '';
                    if (session.status === 'valid' && session.injectFilename) {
                        injectColumn = `<a href="/api/admin/download-inject/${session.injectFilename}?token=${encodeURIComponent(getStoredToken())}" 
                                           class="download-btn" download>
                                            DOWNLOAD INJECT
                                        </a>`;
                    } else {
                        injectColumn = `<span style="color: #666;">NO INJECT SCRIPT</span>`;
                    }

                    // Status badge
                    const statusBadge = session.status === 'valid' 
                        ? `<span style="color: #00ff66; font-weight: bold;">‚úÖ VALID</span>`
                        : `<span style="color: #ff3333; font-weight: bold;">‚ùå INVALID</span>`;

                    row.innerHTML = `
                        <td>${statusBadge}</td>
                        <td class="email-cell">${session.email}</td>
                        <td>${passwordColumn}</td>
                        <td>${injectColumn}</td>
                        <td>
                            <div>ID: ${session.id}</div>
                            <div class="session-info">
                                TIMESTAMP: ${new Date(session.timestamp).toLocaleString()}
                            </div>
                            ${session.status === 'valid' ? 
                                `<div class="session-info">COOKIES: ${session.totalCookies} ENCRYPTED</div>` :
                                `<div class="session-info" style="color: #ff6666;">FAILURE REASON: ${session.reason || 'Unknown Error'}</div>
                                 ${session.errorMessage ? `<div class="session-info" style="color: #ff9999;">ERROR DETAILS: ${session.errorMessage}</div>` : ''}
                                 <div class="session-info" style="color: #ffcc99;">STATUS: FAILED AUTHENTICATION</div>`
                            }
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });

                document.getElementById('sessions-content').style.display = 'block';

            } catch (error) {
                console.error('Error loading sessions:', error);
                document.getElementById('loading').style.display = 'none';
                const errorDiv = document.getElementById('error');
                errorDiv.textContent = `SYSTEM ERROR: ${error.message}`;
                errorDiv.style.display = 'block';
            }
        }

        // Load analytics data
        async function loadAnalytics() {
            if (!isAuthenticated) {
                // Set loading state for analytics
                document.getElementById('total-visits').textContent = '-';
                document.getElementById('valid-entries').textContent = '-';
                document.getElementById('invalid-entries').textContent = '-';
                document.getElementById('success-rate').textContent = '-';
                return;
            }

            try {
                const token = getStoredToken();
                console.log('Loading analytics with token...');
                
                const response = await fetch(`/api/admin/analytics?token=${encodeURIComponent(token)}`);
                
                if (response.status === 401) {
                    console.error('Analytics: Unauthorized access');
                    logout();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const analytics = await response.json();
                console.log('Analytics data received:', analytics);
                
                // Update dashboard cards with animation
                updateAnalyticsCard('total-visits', analytics.totalVisits || 0);
                updateAnalyticsCard('valid-entries', analytics.validEntries || 0);
                updateAnalyticsCard('invalid-entries', analytics.invalidEntries || 0);
                
                // Calculate success rate
                const total = (analytics.validEntries || 0) + (analytics.invalidEntries || 0);
                const successRate = total > 0 ? Math.round((analytics.validEntries / total) * 100) : 0;
                updateAnalyticsCard('success-rate', successRate + '%');

                console.log('Analytics updated successfully');

            } catch (error) {
                console.error('Error loading analytics:', error);
                // Set error state
                document.getElementById('total-visits').textContent = 'ERROR';
                document.getElementById('valid-entries').textContent = 'ERROR';
                document.getElementById('invalid-entries').textContent = 'ERROR';
                document.getElementById('success-rate').textContent = 'ERROR';
            }
        }

        // Helper function to update analytics cards with animation
        function updateAnalyticsCard(elementId, value) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style.opacity = '0.5';
                setTimeout(() => {
                    element.textContent = value;
                    element.style.opacity = '1';
                }, 100);
            }
        }

        // Cloudflare Management Functions
        async function loadCloudflareStatus() {
            if (!isAuthenticated) {
                document.getElementById('cf-status').textContent = 'AUTH REQUIRED';
                return;
            }

            try {
                const token = getStoredToken();
                const response = await fetch(`/api/admin/cloudflare/status?token=${encodeURIComponent(token)}`);
                
                if (response.status === 401) {
                    logout();
                    return;
                }

                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('cf-status').textContent = 'ONLINE';
                    document.getElementById('cf-status').style.color = '#00ff66';
                    
                    // Update status displays
                    updateCloudflareStatus(data.settings);
                } else {
                    document.getElementById('cf-status').textContent = 'ERROR';
                    document.getElementById('cf-status').style.color = '#ff3333';
                }
            } catch (error) {
                console.error('Error loading Cloudflare status:', error);
                document.getElementById('cf-status').textContent = 'OFFLINE';
                document.getElementById('cf-status').style.color = '#ff3333';
            }
        }

        function updateCloudflareStatus(settings) {
            // Update Bot Fight Mode
            document.getElementById('bot-fight-status').textContent = settings.botFightMode ? 'ON' : 'OFF';
            document.getElementById('bot-fight-status').style.color = settings.botFightMode ? '#00ff66' : '#ff6666';
            
            // Update Security Level
            document.getElementById('security-level-status').textContent = settings.securityLevel.toUpperCase();
            document.getElementById('security-level-select').value = settings.securityLevel;
            
            const securityColors = {
                'off': '#666',
                'essentially_off': '#999',
                'low': '#ffff66',
                'medium': '#ff9933',
                'high': '#ff6666',
                'under_attack': '#ff0000'
            };
            document.getElementById('security-level-status').style.color = securityColors[settings.securityLevel] || '#ff6666';
            
            // Update Browser Check
            document.getElementById('browser-check-status').textContent = settings.browserCheck ? 'ON' : 'OFF';
            document.getElementById('browser-check-status').style.color = settings.browserCheck ? '#00ff66' : '#ff6666';
        }

        async function toggleBotFight() {
            if (!isAuthenticated) return;

            const btn = document.getElementById('bot-fight-btn');
            btn.disabled = true;
            btn.textContent = 'PROCESSING...';

            try {
                const currentStatus = document.getElementById('bot-fight-status').textContent === 'ON';
                const token = getStoredToken();
                
                const response = await fetch(`/api/admin/cloudflare/bot-fight?token=${encodeURIComponent(token)}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ enabled: !currentStatus })
                });

                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('bot-fight-status').textContent = data.botFightMode ? 'ON' : 'OFF';
                    document.getElementById('bot-fight-status').style.color = data.botFightMode ? '#00ff66' : '#ff6666';
                    console.log(data.message);
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                console.error('Error toggling bot fight:', error);
                alert('Network error occurred');
            } finally {
                btn.disabled = false;
                btn.textContent = 'TOGGLE BOT FIGHT MODE';
            }
        }

        async function setSecurityLevel() {
            if (!isAuthenticated) return;

            const level = document.getElementById('security-level-select').value;
            const token = getStoredToken();

            try {
                const response = await fetch(`/api/admin/cloudflare/security-level?token=${encodeURIComponent(token)}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ level })
                });

                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('security-level-status').textContent = data.securityLevel.toUpperCase();
                    const securityColors = {
                        'off': '#666',
                        'essentially_off': '#999',
                        'low': '#ffff66',
                        'medium': '#ff9933',
                        'high': '#ff6666',
                        'under_attack': '#ff0000'
                    };
                    document.getElementById('security-level-status').style.color = securityColors[data.securityLevel] || '#ff6666';
                    console.log(data.message);
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                console.error('Error setting security level:', error);
                alert('Network error occurred');
            }
        }

        async function toggleBrowserCheck() {
            if (!isAuthenticated) return;

            const btn = document.getElementById('browser-check-btn');
            btn.disabled = true;
            btn.textContent = 'PROCESSING...';

            try {
                const currentStatus = document.getElementById('browser-check-status').textContent === 'ON';
                const token = getStoredToken();
                
                const response = await fetch(`/api/admin/cloudflare/browser-check?token=${encodeURIComponent(token)}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ enabled: !currentStatus })
                });

                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('browser-check-status').textContent = data.browserCheck ? 'ON' : 'OFF';
                    document.getElementById('browser-check-status').style.color = data.browserCheck ? '#00ff66' : '#ff6666';
                    console.log(data.message);
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                console.error('Error toggling browser check:', error);
                alert('Network error occurred');
            } finally {
                btn.disabled = false;
                btn.textContent = 'TOGGLE BROWSER CHECK';
            }
        }

        async function enableUnderAttack() {
            if (!confirm('‚ö†Ô∏è This will enable UNDER ATTACK MODE - very strict security. Continue?')) return;
            
            const token = getStoredToken();
            
            try {
                const response = await fetch(`/api/admin/cloudflare/security-level?token=${encodeURIComponent(token)}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ level: 'under_attack' })
                });

                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('security-level-status').textContent = 'UNDER ATTACK';
                    document.getElementById('security-level-status').style.color = '#ff0000';
                    document.getElementById('security-level-select').value = 'under_attack';
                    alert('üö® UNDER ATTACK MODE ENABLED');
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                console.error('Error enabling under attack mode:', error);
                alert('Network error occurred');
            }
        }

        async function disableAllProtection() {
            if (!confirm('‚ö†Ô∏è This will DISABLE ALL PROTECTION. Are you sure?')) return;
            
            const token = getStoredToken();
            
            try {
                // Disable bot fight mode
                await fetch(`/api/admin/cloudflare/bot-fight?token=${encodeURIComponent(token)}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ enabled: false })
                });

                // Set security to off
                await fetch(`/api/admin/cloudflare/security-level?token=${encodeURIComponent(token)}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ level: 'off' })
                });

                // Disable browser check
                await fetch(`/api/admin/cloudflare/browser-check?token=${encodeURIComponent(token)}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ enabled: false })
                });

                // Refresh status
                setTimeout(() => loadCloudflareStatus(), 1000);
                alert('üîì ALL PROTECTION DISABLED');
            } catch (error) {
                console.error('Error disabling protection:', error);
                alert('Network error occurred');
            }
        }

        // Load authentication state when page loads
        document.addEventListener('DOMContentLoaded', checkAuthOnLoad);

        // Enhanced refresh to include Cloudflare status
        setInterval(() => {
            if (isAuthenticated) {
                loadSessions();
                loadAnalytics();
                loadCloudflareStatus();
            }
        }, 30000);

        // Load Cloudflare status when authenticated
        function updateAuthUI(authenticated) {
            isAuthenticated = authenticated;
            const authSection = document.getElementById('auth-section');
            const authForm = document.getElementById('auth-form');
            const authSuccess = document.getElementById('auth-success');
            const loading = document.getElementById('loading');
            const sessionsContent = document.getElementById('sessions-content');
            const noSessions = document.getElementById('no-sessions');

            if (authenticated) {
                authSection.classList.add('authenticated');
                authForm.style.display = 'none';
                authSuccess.style.display = 'block';
                loading.style.display = 'block';
                sessionsContent.style.display = 'none';
                noSessions.style.display = 'none';
                // Load Cloudflare status
                setTimeout(() => loadCloudflareStatus(), 500);
            } else {
                authSection.classList.remove('authenticated');
                authForm.style.display = 'block';
                authSuccess.style.display = 'none';
                loading.style.display = 'none';
                sessionsContent.style.display = 'none';
                noSessions.style.display = 'none';
                document.getElementById('error').style.display = 'none';
                // Reset Cloudflare status
                document.getElementById('cf-status').textContent = 'AUTH REQUIRED';
                document.getElementById('cf-status').style.color = '#ff6666';
            }
        }
    </script>
</body>
</html>
